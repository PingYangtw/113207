<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/static/images/favicon.ico" rel="shortcut icon"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/base/reset.css">
  <link rel="stylesheet" href="/static/css/base/global.css">
  <link rel="stylesheet" href="/static/css/components/mousemove.css">
  <link rel="stylesheet" href="/static/css/components/dialog.css">
	<link rel="stylesheet" href="/static/css/layout/navbar.css">
  <link rel="stylesheet" href="/static/css/layout/footer.css">
  <link rel="stylesheet" href="/static/css/task/taskpage.css">
  <link rel="stylesheet" href="/static/css/task/taskbutton.css">
  <link rel="stylesheet" href="/static/css/components/dialog.css">
  <script src="https://kit.fontawesome.com/d9f27795c1.js" crossorigin="anonymous"></script>
  <script src="/static/components/mousemove.js" defer></script>
	<script src="/static/components/layout/navbar.js" defer></script>
  <script src="/static/components/layout/footer.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <title>任務</title>
</head>
<body>
  <div id="myCursor"></div>
  <div id="circle"></div>

  <nav id="nav-container"></nav>

  <article>
    <div class="progress-bar">
      <div class="level">
        <span>LV.</span><p id="level">{{level_data[0]}}</p>
      </div>
      <form action="test.aspx" method="get">
        <progress id="progress" value="{{level_data[1] / level_data[2]}}"></progress>
      </form>
    </div>

    <div class="right">
      <p id="score">{{level_data[1]}}/{{level_data[2]}}</p>
    </div>

    <section>
      <div class="title">
        <div class="text">
          <i class="fa-regular fa-calendar-check"></i>
          <h2>每日任務</h2>
        </div>
      </div>

      <div class="titlecontent">
        {% if '1' in task_data and '1' not in award_data %}
        <a class="eachtask" >
          <p>上線一次<span>+5</span></p>
          <main id=app>
            <div class="static nocancel">
              <button class="rewardButton" data-task-id="1">
                <span>領取獎勵</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% elif '1' in task_data and '1' in award_data %}
        <a class="eachtask">
          <p>上線一次<span>+5</span></p>
          <main id=app>
            <div class="static cancel">
              <button class="rewardButton disabled">
                <span>領取成功</span>
                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% else %}
        <a class="eachtask">
          <p>上線一次<span>+5</span></p>
          <i class="fa-solid fa-circle-chevron-right"></i>
        </a>  
        {% endif %}

        {% if '2' in task_data and '2' not in award_data %}
        <a class="eachtask">
          <p>輸入今日體重<span>+5</span></p>
          <main id=app>
            <div class="static nocancel">
              <button class="rewardButton" data-task-id="2">
                <span>領取獎勵</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% elif '2' in task_data and '2' in award_data %}
        <a class="eachtask">
          <p>輸入今日體重<span>+5</span></p>
          <main id=app>
            <div class="static cancel">
              <button class="rewardButton disabled">
                <span>領取成功</span>
                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% else %}
        <a class="eachtask" href="/goal/goalMain">
          <p>輸入今日體重<span>+5</span></p>
          <i class="fa-solid fa-circle-chevron-right"></i>
        </a>  
        {% endif %}
        
        {% if '3' in task_data and '3' not in award_data %}
        <a class="eachtask">
          <p>生成一次食譜<span>+5</span></p>
          <main id=app>
            <div class="static nocancel">
              <button class="rewardButton" data-task-id="3">
                <span>領取獎勵</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% elif '3' in task_data and '3' in award_data %}
        <a class="eachtask">
          <p>生成一次食譜<span>+5</span></p>
          <main id=app>
            <div class="static cancel">
              <button class="rewardButton disabled">
                <span>領取成功</span>
                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% else %}
        <a class="eachtask" href="/goal/goalMain">
          <p>生成一次食譜<span>+5</span></p>
          <i class="fa-solid fa-circle-chevron-right"></i>
        </a>
        {% endif %}

        {% if '4' in task_data and '4' not in award_data %}
        <a class="eachtask">
          <p>成功打卡一次<span>+5</span></p>
          <main id=app>
            <div class="static nocancel">
              <button class="rewardButton" data-task-id="4">
                <span>領取獎勵</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% elif '4' in task_data and '4' in award_data %}
        <a class="eachtask">
          <p>成功打卡一次<span>+5</span></p>
          <main id=app>
            <div class="static cancel">
              <button class="rewardButton disabled">
                <span>領取成功</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% else %}
        <a class="eachtask" href="/goal/goalMain">
          <p>成功打卡一次<span>+5</span></p>
          <i class="fa-solid fa-circle-chevron-right"></i>
        </a>
        {% endif %}
        {% if '5' in task_data and '5' not in award_data %}
        <a class="eachtask">
          <p>完成個人檔案<span>+5</span></p>
          <main id=app>
            <div class="static nocancel">
              <button class="rewardButton" data-task-id="5">
                <span>領取獎勵</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% elif '5' in task_data and '5' in award_data %}
        <a class="eachtask">
          <p>完成個人檔案<span>+5</span></p>
          <main id=app>
            <div class="static cancel">
              <button class="rewardButton disabled">
                <span>領取成功</span>
                <svg viewBox="0 0 22 22" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                  <line x1="15" y1="16" x2="19" y2="12"></line>
                  <line x1="15" y1="8" x2="19" y2="12"></line>
                </svg>

                <svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M5 12l5 5l10 -10"></path>
                </svg>
          
                <svg class="spinner" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z" />
                </svg>
              </button>
            </div>
          </main>
        </a>
        {% else %}
        <a class="eachtask" href="/profile/profilePage">
          <p>完成個人檔案<span>+5</span></p>
          <i class="fa-solid fa-circle-chevron-right"></i>
        </a>
        {% endif %}
      </div>
    </section>

    <section>
      <div class="title">
        <div class="text">
          <i class="fa-regular fa-calendar-check"></i>
          <h2>里程碑</h2>
          <i class="fa-solid fa-angle-right"></i>
          <h2>打卡小將</h2>
        </div>
        <i class="fa-regular fa-circle-question" id="openinfor"></i>
        <dialog id="infor">
          <h1>如何在里程碑留言?</h1>
          <div class="content">
            <p>在某區塊中達到10次的累積數量，就可以獲得1次在該區塊中留言的機會!加油啊各位!</p>
          </div>
          <div class="save">
            <button id="closeinfor" class="closebtn">close</button>
          </div>
        </dialog>
      </div>
  
      <div class="milestone">
        <div class="accumulation">
          <i class="fa-regular fa-calendar-check"></i>
          <h1>{{ milestone[0][0] }}</h1>
          <span class="label">累積打卡天數</span>
        </div>
        <div class="accumulation">
          <i class="fa-solid fa-chart-line"></i>
          <h1>{{ milestone[1][0] }}</h1>
          <span class="label">累積記錄體重</span>
        </div>
        <div class="accumulation">
          <i class="fa-solid fa-puzzle-piece"></i>
          <h1>{{ milestone[2][0] }}</h1>
          <span class="label">累積生成食譜</span>
        </div>
        <div class="accumulation">
          <i class="fa-regular fa-thumbs-up"></i>
          <h1>{{ milestone[3][0] }}</h1>
          <span class="label">評價食譜數量</span>
        </div>
      </div>

      <div class="comment">
        <div class="commentbtn" id="opencheckcmt">新增留言</div>
        <div class="commentbtn" id="openweightcmt">新增留言</div>
        <div class="commentbtn" id="openrecipecmt">新增留言</div>
        <div class="commentbtn" id="openthumbscmt">新增留言</div>
      </div>
      
      <template id="modal-template">
        <dialog id="">
          <h1>請輸入你的名言佳句~</h1>
          <div class="content">
            <p>(送出後無法修改，累積10次才有1次留言機會，請慎重輸入喔!)</p>
            <textarea rows="5" placeholder="說點甚麼吧~"></textarea>
          </div>
          <div class="save">
            <button class="closebtn">close</button>
            <button class="savebtn">save</button>
          </div>
        </dialog>
      </template>      

      <div class="saying">
        <div class="eachsay">
          <div class="left">
            <img src="/static/images/userImage/Joey1.png" alt="">
            <h6>烤焦羊<span> - 724天:</span></h6>
            <p>很想放棄，但看到這麼多人都成功上英雄榜了，我也不能輸給他們!</p>
          </div>
          <div class="date">2020/7/24</div>
        </div>
        <div class="line"></div>
        <div class="eachsay">
          <div class="left">
            <img src="/static/images/userImage/Agnes1.png" alt="">
            <h6>煙燻雞<span> - 624天:</span></h6>
            <p>唷囉奔~甘巴爹~fighting!</p>
          </div>
          <div class="date">2021/6/24</div>
        </div>
        <div class="line"></div>
        <div class="eachsay">
          <div class="left">
            <img src="/static/images/userImage/man1.png" alt="">
            <h6>志明<span> - 520天:</span></h6>
            <p>來!卡拿去~要點甚麼都可以，隨便點</p>
          </div>
          <div class="date">2022/5/20</div>
        </div>
        <div class="line"></div>
        <div class="eachsay">
          <div class="left">
            <img src="/static/images/userImage/Ping1.png" alt="">
            <h6>春嬌<span> - 116天:</span></h6>
            <p>><志明我來了~</p>
          </div>
          <div class="date">2023/11/6</div>
        </div>
        <div class="line"></div>
        <div class="eachsay">
          <div class="left">
            <img src="/static/images/userImage/Belle2.png" alt="">
            <h6>朝天椒<span> - 1231天:</span></h6>
            <p>本小姐駕到!全部人通通閃開!!!!!</p>
          </div>
          <div class="date">2024/5/11</div>
        </div>
        <div class="line"></div>
        <div class="eachsay">
          <div class="left">
            <img src="/static/images/userImage/woman2.png" alt="">
            <h6>醜魚<span> - 217天:</span></h6>
            <p>努估誰唷?我是誰?我在哪?</p>
          </div>
          <div class="date">2024/2/17</div>
        </div>
      </div>

      <dialog id="loginDialog">
        <h1>請先登入</h1>
        <div class="contentsave">
          <button class="savebtn" onclick="window.location.href='/login/loginPage'">login</button>
        </div>
      </dialog>

      <canvas class="fireworks"></canvas>
    </section>

    <dialog id="loginDialog">
      <h1>請先登入</h1>
      <div class="contentsave">
        <button class="savebtn" onclick="window.location.href='/login/loginPage'">login</button>
      </div>
    </dialog>
  </article>

  <footer id="footer-container"></footer>

  <script>
		let messageText = "{{name}}";
    let userImage = "{{userImage}}"
    let uid = "{{uid}}";

    window.onload = function() {
      renderNav();
      renderFooter();

      if (messageText == "0") {
        document.getElementById("loginDialog").showModal();
      }
    };

    // 里程碑 留言開合、accumulation點選樣式
    document.addEventListener("DOMContentLoaded", function() {
      let accumulations = document.querySelectorAll(".accumulation");
      let currentAccumulation = null;

      accumulations.forEach(function(accumulation) {
        accumulation.addEventListener("click", function() {
          accumulations.forEach(item => {
            if (item !== this && item.classList.contains('active')) {
              item.classList.remove('active');
            }
          });

          this.classList.toggle('active');
          let saying = document.querySelector(".saying");

          if (this === currentAccumulation & currentAccumulation === accumulation) {
            currentAccumulation = null;
            saying.style.display = saying.style.display === "none" || saying.style.display === "" ? "block" : "none";
          } else {
            currentAccumulation = this;
            saying.style.display = "block";
            currentAccumulation = accumulation;
          }
        });
      });
    });

    // 彈跳視窗
    function setupModal(openBtnId, modalId, closeBtnClass) {
      const openBtn = document.getElementById(openBtnId);
      const modal = document.getElementById(modalId);
      const closeBtn = modal.querySelector(`.${closeBtnClass}`);

      openBtn.addEventListener("click", () => modal.showModal());
      closeBtn.addEventListener("click", () => modal.close());
    }

    const modals = [
      ['opencheckcmt', 'checkcmt'],     // 輸入累積打卡天數留言
      ['openweightcmt', 'weightcmt'],   // 輸入累積記錄體重留言
      ['openrecipecmt', 'recipecmt'],   // 輸入累積生成食譜留言
      ['openthumbscmt', 'thumbscmt']    // 輸入食譜獲讚數量留言
    ];

    const template = document.getElementById('modal-template');

    modals.forEach(([openBtnId, modalId]) => {
      const clone = template.content.cloneNode(true);
      const dialog = clone.querySelector('dialog');
      dialog.id = modalId;
      dialog.querySelector('.closebtn').id = `close${modalId}`;
      document.body.appendChild(clone);
      setupModal(openBtnId, modalId, 'closebtn');
    });

    // 任務按鈕
    document.addEventListener('DOMContentLoaded', function() {
      const rewardButtons = document.querySelectorAll('.rewardButton');
      const levelElement = document.getElementById('level');
      const progressElement = document.getElementById('progress');
      const scoreElement = document.getElementById('score');
      const levels = [10, 20, 40, 65, 90, 125, 150, 200, 300, 500];

      let currentScore = "{{level_data[1]}}"
      let currentLevel = "{{level_data[0]}}"

      function updateProgress() {
        const levelMax = levels[currentLevel - 1];
        scoreElement.textContent = `${currentScore}/${levelMax}`;
        progressElement.value = currentScore / levelMax;
        levelElement.textContent = currentLevel;
      }

      function triggerFireworks() {
        var duration = 15 * 300;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        function randomInRange(min, max) {
          return Math.random() * (max - min) + min;
        }

        var interval = setInterval(function() {
          var timeLeft = animationEnd - Date.now();

          if (timeLeft <= 0) {
            return clearInterval(interval);
          }

          var particleCount = 50 * (timeLeft / duration);
          confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
          confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
        }, 250);
      }
    
      rewardButtons.forEach(button => {
        button.addEventListener('click', function() {
          const btn = this;

          $.ajax({
            url: '/task/receiveTask',
            type: 'POST',
            data: {
              task_id: btn.getAttribute('data-task-id')
            },
            success: function(response) {
              const staticDiv = btn.closest('.static');
              const firstSvg = btn.querySelector('svg:nth-child(2)');
              const svgToToggle = btn.querySelector('svg:nth-child(3)');

              staticDiv.classList.remove('nocancel');
              staticDiv.classList.add('cancel');

              btn.classList.add("disabled");
                    
              firstSvg.style.display = 'none';
              svgToToggle.style.display = '';

              btn.querySelector('span').textContent = '領取成功';

              document.activeElement.blur();

              currentScore = parseInt(currentScore);

              currentScore += 5;
              const levelMax = levels[currentLevel - 1];
              
              console.log(currentScore, levelMax);

              if (currentScore >= levelMax) {
                currentLevel++;
                currentScore = 0;
                triggerFireworks();
              }

              updateProgress();
            },
            error: function(xhr, status, error) {
              console.error(error);
              alert(xhr.responseText);
            },
          });
        });
      });
    });
	</script>
</body>
</html>